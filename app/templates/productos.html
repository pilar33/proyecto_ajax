{% load static %}


<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="mb-0">Lista de productos</h1>
  <div>
    <button id="btnAgregarProducto" class="btn btn-primary me-2">Agregar</button>
    <a href="{% url 'reporteProducto' %}" target="_blank" class="btn btn-danger">
      <i class="bi bi-filetype-pdf"></i> Generar PDF
    </a>
  </div>
</div>

<table id="tblProductos" class="table table-striped table-bordered w-100">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Descripci√≥n</th>
      <th>Estado</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script type="text/javascript">
$(document).ready(function() {
  if (!$.fn.DataTable.isDataTable('#tblProductos')) {
    $('#tblProductos').DataTable({
      ajax: {
        url: "{% url 'api_productos' %}",
        dataSrc: "data"
      },
      columns: [
        { data: "nombre" },
        { data: "descripcion" },
        { data: "iEstado" }
      ]
    });
  }

  $('#btnAgregarProducto').off('click').on('click', function() {
    const url = "{% url 'add_productos' %}";
    bootbox.dialog({
      title: 'Formulario',
      message: "<iframe id='formIframe' src='" + url + "' scrolling='yes' frameborder='0' width='100%' height='600'></iframe>",
      size: 'large',
      buttons: {
        cancel: {
          label: 'Cerrar',
          className: 'btn-secondary',
          callback: function () {
            cargarContenido("{% url 'productos' %}");
          }
        }
      }
    });

    window.addEventListener('message', function(event) {
      if (event.data && event.data.action === 'closeBootbox') {
        bootbox.hideAll();
        cargarContenido("{% url 'productos' %}");
      }
    }, { once: true });
  });
});
</script>



